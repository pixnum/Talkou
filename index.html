<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Talkou - TTS App</title>
<style>
  :root {
    --bg: #e0e0e0;
    --text: #333;
    --shadow-light: #ffffff;
    --shadow-dark: #bebebe;
  }
  body.dark {
    --bg: #2c2f33;
    --text: #f0f0f0;
    --shadow-light: #3a3d42;
    --shadow-dark: #1e2023;
  }
  body {
    background: var(--bg);
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    color: var(--text);
    flex-direction: column;
    transition: background 0.3s, color 0.3s;
  }
  .container {
    background: var(--bg);
    border-radius: 20px;
    padding: 20px;
    max-width: 90vw;
    width: 400px;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 8px 8px 16px var(--shadow-dark),
      -8px -8px 16px var(--shadow-light);
    transition: background 0.3s, box-shadow 0.3s;
  }
  h1 {
    font-size: 1.5em;
    text-align: center;
    margin-bottom: 15px;
  }
  textarea,
  select,
  input[type="range"],
  button,
  input[type="file"] {
    width: 100%;
    margin-bottom: 12px;
    border: none;
    border-radius: 12px;
    padding: 10px;
    font-size: 1em;
    outline: none;
    background: var(--bg);
    box-shadow: 4px 4px 8px var(--shadow-dark),
      -4px -4px 8px var(--shadow-light);
    transition: background 0.3s, box-shadow 0.3s;
  }
  textarea {
    height: 100px;
    resize: none;
    box-shadow: inset 4px 4px 8px var(--shadow-dark),
      inset -4px -4px 8px var(--shadow-light);
  }
  button {
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
  }
  button:active {
    box-shadow: inset 4px 4px 8px var(--shadow-dark),
      inset -4px -4px 8px var(--shadow-light);
  }
  label {
    font-size: 0.9em;
    align-self: flex-start;
    margin-bottom: 3px;
  }
  footer {
    margin-top: 15px;
    font-size: 0.8em;
    opacity: 0.7;
    text-align: center;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üó£ Talkou - TTS App</h1>
    <button onclick="toggleDarkMode()">üåô Toggle Dark Mode</button>

    <textarea
      id="text"
      placeholder="Type or upload text..."
      spellcheck="false"
    ></textarea>

    <label for="fileInput">Upload File (.txt, .pdf, .docx)</label>
    <input type="file" id="fileInput" accept=".txt,.pdf,.docx" />

    <label for="languageSelect">Language</label>
    <select id="languageSelect"></select>

    <label for="voiceSelect">Voice</label>
    <select id="voiceSelect"></select>

    <label for="pitch">Pitch</label>
    <input type="range" id="pitch" min="0" max="2" value="1" step="0.1" />

    <label for="rate">Speed</label>
    <input type="range" id="rate" min="0.5" max="2" value="1" step="0.1" />

    <label for="volume">Volume</label>
    <input type="range" id="volume" min="0" max="1" value="1" step="0.1" />

    <button onclick="speak()">‚ñ∂ Speak</button>
    <button onclick="stop()">‚èπ Stop</button>
    <button onclick="clearText()">üßπ Clear</button>
  </div>

  <footer>¬© Talkou 2025</footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/franc-min@5.0.0/franc.min.js"></script>
  <script>
    const textInput = document.getElementById("text");
    const voiceSelect = document.getElementById("voiceSelect");
    const languageSelect = document.getElementById("languageSelect");
    const pitchInput = document.getElementById("pitch");
    const rateInput = document.getElementById("rate");
    const volumeInput = document.getElementById("volume");
    const fileInput = document.getElementById("fileInput");

    let voices = [];
    const languages = [
      { code: "en", name: "English" },
      { code: "hi", name: "Hindi" },
      { code: "es", name: "Spanish" },
      { code: "fr", name: "French" },
      { code: "de", name: "German" },
      { code: "ru", name: "Russian" },
      { code: "zh", name: "Chinese" },
      { code: "ja", name: "Japanese" },
      { code: "ko", name: "Korean" },
      { code: "ar", name: "Arabic" },
      { code: "it", name: "Italian" },
      { code: "pt", name: "Portuguese" },
      { code: "bn", name: "Bengali" },
      { code: "pa", name: "Punjabi" },
      { code: "ta", name: "Tamil" },
      { code: "te", name: "Telugu" },
      { code: "tr", name: "Turkish" },
      { code: "pl", name: "Polish" },
      { code: "uk", name: "Ukrainian" },
      { code: "vi", name: "Vietnamese" },
    ];

    // Map franc ISO6393 to our language codes
    // franc returns ISO639-3 codes, so map those for the 20 languages:
    const francToLangMap = {
      eng: "en",
      hin: "hi",
      spa: "es",
      fra: "fr",
      deu: "de",
      rus: "ru",
      cmn: "zh", // Mandarin Chinese
      jpn: "ja",
      kor: "ko",
      ara: "ar",
      ita: "it",
      por: "pt",
      ben: "bn",
      pan: "pa",
      tam: "ta",
      tel: "te",
      tur: "tr",
      pol: "pl",
      ukr: "uk",
      vie: "vi",
    };

    languages.forEach((lang) => {
      const option = document.createElement("option");
      option.value = lang.code;
      option.textContent = lang.name;
      languageSelect.appendChild(option);
    });

    function loadVoices() {
      voices = speechSynthesis.getVoices();
      filterVoices();
    }

    function filterVoices() {
      const selectedLang = languageSelect.value;
      voiceSelect.innerHTML = "";
      const filtered = voices.filter((voice) =>
        voice.lang.toLowerCase().startsWith(selectedLang)
      );
      filtered.forEach((voice) => {
        const option = document.createElement("option");
        option.value = voices.indexOf(voice);
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
      // Auto-select first voice if available
      if (voiceSelect.options.length > 0) {
        voiceSelect.selectedIndex = 0;
      }
    }

    languageSelect.addEventListener("change", filterVoices);
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speak() {
      if (speechSynthesis.speaking) speechSynthesis.cancel();
      if (!textInput.value.trim()) return alert("Please enter some text.");
      const utterance = new SpeechSynthesisUtterance(textInput.value);
      const selectedVoice = voices[voiceSelect.value];
      if (selectedVoice) utterance.voice = selectedVoice;
      utterance.pitch = parseFloat(pitchInput.value);
      utterance.rate = parseFloat(rateInput.value);
      utterance.volume = parseFloat(volumeInput.value);
      speechSynthesis.speak(utterance);
    }
    function stop() {
      speechSynthesis.cancel();
    }
    function clearText() {
      textInput.value = "";
    }
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    // Auto-detect language based on text content
    function autoDetectLanguage(text) {
      if (!text.trim()) return; // skip empty
      const francCode = franc.min(text);
      const langCode = francToLangMap[francCode];
      if (langCode && langCode !== languageSelect.value) {
        languageSelect.value = langCode;
        filterVoices();
      }
    }

    // Detect language on text input (debounced)
    let debounceTimer;
    textInput.addEventListener("input", () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        autoDetectLanguage(textInput.value);
      }, 700);
    });

    // Handle file upload
    fileInput.addEventListener("change", async () => {
      const file = fileInput.files[0];
      if (!file) return;

      if (file.type === "text/plain") {
        const text = await file.text();
        textInput.value = text;
        autoDetectLanguage(text);
      } else if (file.type === "application/pdf") {
        const reader = new FileReader();
        reader.onload = async function () {
          const typedarray = new Uint8Array(this.result);
          const pdf = await pdfjsLib.getDocument(typedarray).promise;
          let text = "";
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            text += content.items.map((s) => s.str).join(" ") + "\n";
          }
          textInput.value = text;
          autoDetectLanguage(text);
        };
        reader.readAsArrayBuffer(file);
      } else if (
        file.type ===
        "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
      ) {
        const reader = new FileReader();
        reader.onload = async function (event) {
          const result = await mammoth.extractRawText({
            arrayBuffer: event.target.result,
          });
          textInput.value = result.value;
          autoDetectLanguage(result.value);
        };
        reader.readAsArrayBuffer(file);
      } else {
        alert("Unsupported file type!");
      }
    });

    loadVoices();
  </script>
</body>
</html>
